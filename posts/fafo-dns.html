<!DOCTYPE html> <html lang="en"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>FAFO: DNS Issues | Vinay Jain</title> <meta name="generator" content="Jekyll v4.4.1"/> <meta property="og:title" content="FAFO: DNS Issues"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Discover how to set up a Raspberry Pi as a local development server with Pi-hole for custom DNS management. Follow along as I troubleshoot and resolve DNS issues for multiple local web apps, using IPv6 configurations for a streamlined, accessible dev environment."/> <meta property="og:description" content="Discover how to set up a Raspberry Pi as a local development server with Pi-hole for custom DNS management. Follow along as I troubleshoot and resolve DNS issues for multiple local web apps, using IPv6 configurations for a streamlined, accessible dev environment."/> <link rel="canonical" href="https://vinayjain.me/posts/fafo-dns"/> <meta property="og:url" content="https://vinayjain.me/posts/fafo-dns"/> <meta property="og:site_name" content="Vinay Jain"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2024-11-12T00:00:00+00:00"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="FAFO: DNS Issues"/> <meta name="twitter:site" content="@vinayjn7"/> <meta name="google-site-verification" content="aiR9EuE5YjF6QsTSZzDbX_aQcQQINSTVPMgT1ru97ls"/> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-11-12T00:00:00+00:00","datePublished":"2024-11-12T00:00:00+00:00","description":"Discover how to set up a Raspberry Pi as a local development server with Pi-hole for custom DNS management. Follow along as I troubleshoot and resolve DNS issues for multiple local web apps, using IPv6 configurations for a streamlined, accessible dev environment.","headline":"FAFO: DNS Issues","mainEntityOfPage":{"@type":"WebPage","@id":"https://vinayjain.me/posts/fafo-dns"},"url":"https://vinayjain.me/posts/fafo-dns"}</script> <link rel="stylesheet" href="/assets/css/normalize.css"> <link id="theme-link" rel="stylesheet" href="/assets/css/light.css"><link type="application/atom+xml" rel="alternate" href="https://vinayjain.me/feed.xml" title="Vinay Jain"/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-128287990-1"></script> <script>function gtag(){dataLayer.push(arguments)}window["ga-disable-UA-128287990-1"]="1"===window.doNotTrack||"1"===navigator.doNotTrack||"yes"===navigator.doNotTrack||"1"===navigator.msDoNotTrack,window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-128287990-1");</script> </head> <body><header> <div class="wrapper header"> <div class="upper"> <a href="/" class="left-nav"> <h5 class="mClear nav-root"> $ cd /home/</h5> <span class="nav-cursor"></span> </a> <div class="right-nav"> <nav> <a id="menu" class="burger-nav"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z"/> <path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z"/> <path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z"/> </svg> </a> <ul id="nav-trigger"> <li><a href="/all-posts/"> Blog</a></li><li><a href="/bookshelf/"> Books</a></li> </ul> </nav> </div> </div><ul class="social-links"><li class="social-link"> <a target="_blank" href="https://www.linkedin.com/in/vinayjn/"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M13 21H9V9H13V11C13.8526 9.91525 15.1456 9.26857 16.525 9.237C19.0056 9.25077 21.0072 11.2694 21 13.75V21H17V14.25C16.84 13.1326 15.8818 12.3036 14.753 12.306C14.2593 12.3216 13.7932 12.5378 13.4624 12.9046C13.1316 13.2715 12.9646 13.7573 13 14.25V21ZM7 21H3V9H7V21ZM5 7C3.89543 7 3 6.10457 3 5C3 3.89543 3.89543 3 5 3C6.10457 3 7 3.89543 7 5C7 5.53043 6.78929 6.03914 6.41421 6.41421C6.03914 6.78929 5.53043 7 5 7Z"/> </svg> </a> </li><li class="social-link"> <a target="_blank" href="https://github.com/vinayjn"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M12.026 2C7.13295 1.99937 2.96183 5.54799 2.17842 10.3779C1.395 15.2079 4.23061 19.893 8.87302 21.439C9.37302 21.529 9.55202 21.222 9.55202 20.958C9.55202 20.721 9.54402 20.093 9.54102 19.258C6.76602 19.858 6.18002 17.92 6.18002 17.92C5.99733 17.317 5.60459 16.7993 5.07302 16.461C4.17302 15.842 5.14202 15.856 5.14202 15.856C5.78269 15.9438 6.34657 16.3235 6.66902 16.884C6.94195 17.3803 7.40177 17.747 7.94632 17.9026C8.49087 18.0583 9.07503 17.99 9.56902 17.713C9.61544 17.207 9.84055 16.7341 10.204 16.379C7.99002 16.128 5.66202 15.272 5.66202 11.449C5.64973 10.4602 6.01691 9.5043 6.68802 8.778C6.38437 7.91731 6.42013 6.97325 6.78802 6.138C6.78802 6.138 7.62502 5.869 9.53002 7.159C11.1639 6.71101 12.8882 6.71101 14.522 7.159C16.428 5.868 17.264 6.138 17.264 6.138C17.6336 6.97286 17.6694 7.91757 17.364 8.778C18.0376 9.50423 18.4045 10.4626 18.388 11.453C18.388 15.286 16.058 16.128 13.836 16.375C14.3153 16.8651 14.5612 17.5373 14.511 18.221C14.511 19.555 14.499 20.631 14.499 20.958C14.499 21.225 14.677 21.535 15.186 21.437C19.8265 19.8884 22.6591 15.203 21.874 10.3743C21.089 5.54565 16.9181 1.99888 12.026 2Z"/> </svg> </a> </li><li class="social-link"> <a target="_blank" href="https://twitter.com/vinayjn7"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M19.995 6.688C20.8914 6.15209 21.5622 5.30824 21.882 4.314C21.0397 4.81381 20.118 5.16588 19.157 5.355C17.8246 3.94553 15.7135 3.60253 14.0034 4.51766C12.2933 5.43279 11.4075 7.37949 11.841 9.27C8.39062 9.09678 5.17598 7.46692 2.99702 4.786C1.85986 6.74742 2.44097 9.25479 4.32502 10.516C3.64372 10.4941 2.97754 10.3096 2.38202 9.978C2.38202 9.996 2.38202 10.014 2.38202 10.032C2.38241 12.0752 3.82239 13.8351 5.82502 14.24C5.19308 14.4119 4.53022 14.4372 3.88702 14.314C4.45021 16.0613 6.06057 17.2583 7.89601 17.294C6.37585 18.4871 4.49849 19.1342 2.56602 19.131C2.22349 19.1315 1.88123 19.1118 1.54102 19.072C3.50341 20.333 5.78738 21.0024 8.12001 21C11.3653 21.0223 14.484 19.7429 16.7787 17.448C19.0734 15.1531 20.3526 12.0343 20.33 8.789C20.33 8.603 20.3257 8.418 20.317 8.234C21.1575 7.62661 21.8828 6.87415 22.459 6.012C21.676 6.35907 20.8455 6.58693 19.995 6.688Z"/> </svg> </a> </li><li class="social-link"> <a target="_blank" href="https://stackoverflow.com/users/2286267/vinay-jain"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M18.84 20.999H4.38098V14.599H5.98098V19.399H17.24V14.599H18.84V20.999ZM15.64 17.799H7.58098V16.199H15.636V17.799H15.64ZM15.64 15.799L7.78098 14.16L8.11898 12.608L15.98 14.25L15.637 15.799H15.64ZM16.079 13.762L8.79898 10.362V10.356L9.47298 8.899L16.754 12.299L16.081 13.763L16.079 13.762ZM17.002 11.917L10.832 6.777H10.841L11.854 5.563L18.016 10.699L16.999 11.918L17.002 11.917ZM18.31 10.417L13.503 3.968L14.813 2.999L19.619 9.45L18.307 10.421L18.31 10.417Z"/> </svg> </a> </li></ul> </div> </header><main class="page-content" aria-label="Content"> <div class="wrapper"> <article class="h-entry" itemscope itemtype="http://schema.org/BlogPosting"><h2 class="mClear page-title" itemprop="name headline">FAFO: DNS Issues</h1> <div class="post-content e-content" itemprop="articleBody"> <p>I’ve decided to introduce a new category of posts on my blog called FAFO. By now, you probably know what it stands for, so I’ll skip the full form. These posts will essentially be write-ups on challenges I’ve encountered and how I managed to overcome them through trial and exploration.</p> <p>In the first FAFO post, I’ll be sharing how I solved DNS issues on the dev environment for the backend projects I’m working on.</p> <p>Instead of running a local Django server on my Mac during development, I prefer to have everything on a Raspberry Pi 5 running on the local network. This approach offers some clear advantages:</p> <ul> <li>The backend server remains accessible even when the Mac is turned off, which is particularly useful when building mobile apps.</li> <li>It frees up storage space on my Mac by keeping server-related dependencies like Docker and DB software on the Pi.</li> <li>It provides a setup closer to a real production environment, especially when not using Docker.</li> <li>If anything goes wrong, I can quickly spin up a new Pi using a custom script I’ve prepared.</li> </ul> <p>Now, if I only had one web app running on the Pi, things would be simple. I’ve assigned the name <code class="language-plaintext highlighter-rouge">raspberrypi.local</code> to the Pi, so using “http://raspberrypi.local” in the request URL would work fine. However, I have multiple web apps, which presented a challenge in making them all accessible on devices across the network.</p> <p>I considered a few options:</p> <ul> <li>Using port numbers (not ideal due to ugly URLs and potential conflicts with production configs)</li> <li>Changing <code class="language-plaintext highlighter-rouge">/etc/hosts</code> for each device (too much effort and not efficient)</li> <li>Adding DNS entries in the router settings (led to <code class="language-plaintext highlighter-rouge">CORS</code> issues with React frontend projects)</li> </ul> <p>While these options could work, I wasn’t fully satisfied. Then I remembered that I had <code class="language-plaintext highlighter-rouge">Pi-hole</code> set up on the Raspberry Pi, primarily for blocking ads on the local network. Pi-hole was already configured as the DNS server, and I could add custom DNS mappings there.</p> <p>To set up a custom domain in Pi-hole, follow these steps:</p> <ol> <li> <p>Add Local DNS Entry:</p> <p>In Pi-hole, go to <code class="language-plaintext highlighter-rouge">Settings &gt; DNS</code> and locate the Local DNS Records section. Add an entry for your custom domain (e.g., <code class="language-plaintext highlighter-rouge">project.raspberrypi.local</code>) and point it to your Raspberry Pi’s IP address, such as <code class="language-plaintext highlighter-rouge">192.168.1.10</code>.</p> </li> <li> <p>Restart Pi-hole DNS Service:</p> <p>After adding the DNS entry, restart Pi-hole’s DNS service to apply changes:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo pihole restartdns
</code></pre></div> </div> </li> <li> <p>Verify the Setup Locally on Pi-hole:</p> <p>Run a ping for project.raspberrypi.local on the Raspberry Pi itself to ensure that Pi-hole resolves it correctly:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ping project.raspberrypi.local
</code></pre></div> </div> </li> </ol> <p>If this resolves correctly, the custom DNS entry is likely set up properly within Pi-hole.</p> <div class="image-box"> <img class="image-box-item" width="100%" height="100%" src="/images/fafo/dns/piholedns.png"/> </div> <p>However, in my case, after setting up the mappings in Pi-hole and configuring Nginx on the Raspberry Pi to route requests, I encountered an unexpected issue. DNS resolution was failing on my devices. I ran ping for these names on different devices and found out that the request wasn’t even showing up on the Pi-hole query log.</p> <p>I ran <code class="language-plaintext highlighter-rouge">nslookup</code> and I got the response;</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜ nslookup project1.raspberrypi.local
  Server:       fe80::1%13
  Address:      fe80::1%13#53

  <span class="k">**</span> server cannot find project1.raspberrypi.local: NXDOMAIN
  Server:       192.168.1.10
  Address:      192.168.1.10#53

➜ nslookup project1.raspberrypi.local 192.168.1.10
  Server:       192.168.1.10
  Address:      192.168.1.10#53

  Name:	project1.raspberrypi.local
  Address: 192.168.1.10
</code></pre></div></div> <p>After some digging, I realized that IPv6 was the culprit behind the DNS resolution issues. The <code class="language-plaintext highlighter-rouge">nslookup</code> results confirmed that the requests were still not going through Pi-hole and returned the dreaded “NXDOMAIN” error. This was unexpected since I’d set Pi-hole as the primary DNS server in router settings.</p> <p>To solve this, I had to disable IPv6 on the router to ensure all DNS traffic would go through Pi-hole. I then enabled IPv6 support within Pi-hole itself to prevent any lingering IPv6 requests from slipping through. After these adjustments, I finally had the setup working exactly as I intended. Now, all project-specific names, like project1.raspberrypi.local and project2.raspberrypi.local, mapped directly to the Pi’s IP address, and nslookup responded as expected:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜ nslookup project1.raspberrypi.local
Server:		192.168.1.10
Address:	192.168.1.10#53

Name:	project1.raspberrypi.local
Address: 192.168.1.10

➜ nslookup project2.raspberrypi.local
Server:		192.168.1.10
Address:	192.168.1.10#53

Name:	project2.raspberrypi.local
Address: 192.168.1.10
</code></pre></div></div> <p>There are probably simpler ways to get a setup like this running, but I genuinely enjoyed diving into the process and working through each challenge to build something that fits my needs. If you have any insights on different or more efficient ways to tackle this setup, I’d love to hear them! Drop a comment below, or feel free to reach out on Twitter.</p> </div><div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://vinayjain.me/posts/fafo-dns",this.page.identifier="https://vinayjain.me/posts/fafo-dns"};!function(){var t=document,e=t.createElement("script");e.src="https://koderme.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/posts/fafo-dns" hidden></a> </article> </div> </main> <footer> <p>© Vinay Jain 2022 </p> </footer> <script src="/assets/js/main.js?v=2"></script> </body> </html>