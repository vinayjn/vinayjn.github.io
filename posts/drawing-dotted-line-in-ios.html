<!DOCTYPE html> <html lang="en"><head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Drawing Dotted Lines in iOS | Vinay Jain</title> <meta name="generator" content="Jekyll v4.3.2"/> <meta property="og:title" content="Drawing Dotted Lines in iOS"/> <meta property="og:locale" content="en_US"/> <meta name="description" content="Lets see how to do this with UIBezierPath and CAReplicatorLayer"/> <meta property="og:description" content="Lets see how to do this with UIBezierPath and CAReplicatorLayer"/> <link rel="canonical" href="https://vinayjain.me/posts/drawing-dotted-line-in-ios"/> <meta property="og:url" content="https://vinayjain.me/posts/drawing-dotted-line-in-ios"/> <meta property="og:site_name" content="Vinay Jain"/> <meta property="og:type" content="article"/> <meta property="article:published_time" content="2019-08-31T00:00:00+05:30"/> <meta name="twitter:card" content="summary"/> <meta property="twitter:title" content="Drawing Dotted Lines in iOS"/> <meta name="twitter:site" content="@vinayjn7"/> <meta name="google-site-verification" content="aiR9EuE5YjF6QsTSZzDbX_aQcQQINSTVPMgT1ru97ls"/> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-08-31T00:00:00+05:30","datePublished":"2019-08-31T00:00:00+05:30","description":"Lets see how to do this with UIBezierPath and CAReplicatorLayer","headline":"Drawing Dotted Lines in iOS","mainEntityOfPage":{"@type":"WebPage","@id":"https://vinayjain.me/posts/drawing-dotted-line-in-ios"},"url":"https://vinayjain.me/posts/drawing-dotted-line-in-ios"}</script> <link rel="stylesheet" href="/assets/css/normalize.css"> <link id="theme-link" rel="stylesheet" href="/assets/css/light.css"><link type="application/atom+xml" rel="alternate" href="https://vinayjain.me/feed.xml" title="Vinay Jain"/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-128287990-1"></script> <script>function gtag(){dataLayer.push(arguments)}window["ga-disable-UA-128287990-1"]="1"===window.doNotTrack||"1"===navigator.doNotTrack||"yes"===navigator.doNotTrack||"1"===navigator.msDoNotTrack,window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-128287990-1");</script> </head> <body><header> <div class="wrapper header"> <div class="upper"> <a href="/" class="left-nav"> <h5 class="mClear nav-root"> $ cd /home/</h5> <span class="nav-cursor"></span> </a> <div class="right-nav"> <nav> <a id="menu" class="burger-nav"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z"/> <path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z"/> <path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z"/> </svg> </a> <ul id="nav-trigger"> <li><a href="/all-posts/"> Blog</a></li><li><a href="/bookshelf/"> Books</a></li> </ul> </nav> </div> </div><ul class="social-links"><li class="social-link"> <a target="_blank" href="https://www.linkedin.com/in/vinayjn/"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M13 21H9V9H13V11C13.8526 9.91525 15.1456 9.26857 16.525 9.237C19.0056 9.25077 21.0072 11.2694 21 13.75V21H17V14.25C16.84 13.1326 15.8818 12.3036 14.753 12.306C14.2593 12.3216 13.7932 12.5378 13.4624 12.9046C13.1316 13.2715 12.9646 13.7573 13 14.25V21ZM7 21H3V9H7V21ZM5 7C3.89543 7 3 6.10457 3 5C3 3.89543 3.89543 3 5 3C6.10457 3 7 3.89543 7 5C7 5.53043 6.78929 6.03914 6.41421 6.41421C6.03914 6.78929 5.53043 7 5 7Z"/> </svg> </a> </li><li class="social-link"> <a target="_blank" href="https://github.com/vinayjn"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M12.026 2C7.13295 1.99937 2.96183 5.54799 2.17842 10.3779C1.395 15.2079 4.23061 19.893 8.87302 21.439C9.37302 21.529 9.55202 21.222 9.55202 20.958C9.55202 20.721 9.54402 20.093 9.54102 19.258C6.76602 19.858 6.18002 17.92 6.18002 17.92C5.99733 17.317 5.60459 16.7993 5.07302 16.461C4.17302 15.842 5.14202 15.856 5.14202 15.856C5.78269 15.9438 6.34657 16.3235 6.66902 16.884C6.94195 17.3803 7.40177 17.747 7.94632 17.9026C8.49087 18.0583 9.07503 17.99 9.56902 17.713C9.61544 17.207 9.84055 16.7341 10.204 16.379C7.99002 16.128 5.66202 15.272 5.66202 11.449C5.64973 10.4602 6.01691 9.5043 6.68802 8.778C6.38437 7.91731 6.42013 6.97325 6.78802 6.138C6.78802 6.138 7.62502 5.869 9.53002 7.159C11.1639 6.71101 12.8882 6.71101 14.522 7.159C16.428 5.868 17.264 6.138 17.264 6.138C17.6336 6.97286 17.6694 7.91757 17.364 8.778C18.0376 9.50423 18.4045 10.4626 18.388 11.453C18.388 15.286 16.058 16.128 13.836 16.375C14.3153 16.8651 14.5612 17.5373 14.511 18.221C14.511 19.555 14.499 20.631 14.499 20.958C14.499 21.225 14.677 21.535 15.186 21.437C19.8265 19.8884 22.6591 15.203 21.874 10.3743C21.089 5.54565 16.9181 1.99888 12.026 2Z"/> </svg> </a> </li><li class="social-link"> <a target="_blank" href="https://twitter.com/vinayjn7"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M19.995 6.688C20.8914 6.15209 21.5622 5.30824 21.882 4.314C21.0397 4.81381 20.118 5.16588 19.157 5.355C17.8246 3.94553 15.7135 3.60253 14.0034 4.51766C12.2933 5.43279 11.4075 7.37949 11.841 9.27C8.39062 9.09678 5.17598 7.46692 2.99702 4.786C1.85986 6.74742 2.44097 9.25479 4.32502 10.516C3.64372 10.4941 2.97754 10.3096 2.38202 9.978C2.38202 9.996 2.38202 10.014 2.38202 10.032C2.38241 12.0752 3.82239 13.8351 5.82502 14.24C5.19308 14.4119 4.53022 14.4372 3.88702 14.314C4.45021 16.0613 6.06057 17.2583 7.89601 17.294C6.37585 18.4871 4.49849 19.1342 2.56602 19.131C2.22349 19.1315 1.88123 19.1118 1.54102 19.072C3.50341 20.333 5.78738 21.0024 8.12001 21C11.3653 21.0223 14.484 19.7429 16.7787 17.448C19.0734 15.1531 20.3526 12.0343 20.33 8.789C20.33 8.603 20.3257 8.418 20.317 8.234C21.1575 7.62661 21.8828 6.87415 22.459 6.012C21.676 6.35907 20.8455 6.58693 19.995 6.688Z"/> </svg> </a> </li><li class="social-link"> <a target="_blank" href="https://stackoverflow.com/users/2286267/vinay-jain"> <svg class="icon" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"> <path d="M18.84 20.999H4.38098V14.599H5.98098V19.399H17.24V14.599H18.84V20.999ZM15.64 17.799H7.58098V16.199H15.636V17.799H15.64ZM15.64 15.799L7.78098 14.16L8.11898 12.608L15.98 14.25L15.637 15.799H15.64ZM16.079 13.762L8.79898 10.362V10.356L9.47298 8.899L16.754 12.299L16.081 13.763L16.079 13.762ZM17.002 11.917L10.832 6.777H10.841L11.854 5.563L18.016 10.699L16.999 11.918L17.002 11.917ZM18.31 10.417L13.503 3.968L14.813 2.999L19.619 9.45L18.307 10.421L18.31 10.417Z"/> </svg> </a> </li></ul> </div> </header><main class="page-content" aria-label="Content"> <div class="wrapper"> <article class="h-entry" itemscope itemtype="http://schema.org/BlogPosting"><h2 class="mClear page-title" itemprop="name headline">Drawing Dotted Lines in iOS</h1> <div class="post-content e-content" itemprop="articleBody"> <p>My favorite thing in frontend development is building custom user interfaces. It keeps challenging creativity and tests my eye for detail. Most of the times user interfaces give you instant feedback on what works and what doesn’t, based on these feedbacks you keep making changes which further improve the user experience. However, making these changes everytime isn’t easy, very often we hit roadblocks because of the limited functionality or maybe restricted API access. Situations like these pushes you to discover new ways of doing the same thing. As a software engineer you can do so by either browsing Stackoverflow or reading documentation or using your imagination and creativity. One recent encounter of this kind was drawing a dotted line between two points in iOS.</p> <h3 id="dotted-lines">Dotted lines</h3> <p>The designer sent you an Abstract link and you see a dotted line in between two images. You tell the estimates and you start building the new designs. The most common way of drawing a dotted line in iOS is by using a <a href="https://developer.apple.com/documentation/uikit/uibezierpath">UIBezierPath</a> and drawing lines by setting a <a href="https://developer.apple.com/documentation/quartzcore/cashapelayer/1521921-linedashpattern">lineDashPattern</a>. A basic implementation is shown below:</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="kt">UIBezierPath</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">dashPattern</span><span class="p">:</span> <span class="p">[</span><span class="kt">CGFloat</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">]</span>
<span class="n">path</span><span class="o">.</span><span class="nf">setLineDash</span><span class="p">(</span><span class="n">dashPattern</span><span class="p">,</span> <span class="nv">count</span><span class="p">:</span> <span class="n">dashPattern</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="nv">phase</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">path</span><span class="o">.</span><span class="n">lineWidth</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">path</span><span class="o">.</span><span class="n">lineCapStyle</span> <span class="o">=</span> <span class="o">.</span><span class="n">round</span>
<span class="n">path</span><span class="o">.</span><span class="nf">move</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">rect</span><span class="o">.</span><span class="n">minX</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">rect</span><span class="o">.</span><span class="n">midY</span><span class="p">))</span>
<span class="n">path</span><span class="o">.</span><span class="nf">addLine</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="kt">CGPoint</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">rect</span><span class="o">.</span><span class="n">maxX</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="n">rect</span><span class="o">.</span><span class="n">midY</span><span class="p">))</span>
<span class="kt">UIColor</span><span class="o">.</span><span class="n">red</span><span class="o">.</span><span class="nf">setStroke</span><span class="p">()</span>
<span class="n">path</span><span class="o">.</span><span class="nf">stroke</span><span class="p">()</span></code></pre></figure> <p>This code gives the expected output, a dotted line.</p> <p><img src="/images/dotted-lines/xasdcfghnjuhgerfadscvfbf.png" alt="Dots line with UIBezierPath"/></p> <p>It looks fine, but if you look closely you’ll find out that both ends are different. The left end has a partial dot and the right end has some extra spacing left. This unenven spacing is due to the lineDashpattern. The array of values we provide to the pattern tells the system when to paint(0.5) and when to unpaint(16.0). Changing these values won’t help much as they do not consider the frame boundary when drawing. First lets see what the correct output looks like:</p> <p><img src="/images/dotted-lines/csvbgdfmghfnbsvdacscdvbfg.png" alt="Dots with equal spacing"/></p> <p>This line has equal spacing around on both ends. If you think about it, to do this we just want to know how many dots can fit in the available space, then we draw the dots and then do some magic which centers the line in the view it is drawn on. By centering the line we ensure that it has equal space around both ends. I had a few approaches in mind, you can pick any one of them as per your choice, but I am going to discuss only one approach here:</p> <ol> <li>Set the start and end point of the <code class="language-plaintext highlighter-rouge">UIBezierPath</code> line.</li> <li>Use a <a href="https://developer.apple.com/documentation/quartzcore/cashapelayer">CAShapeLayer</a> and only stroke it to the desired length and the set its position to the center.</li> <li>Use a <a href="https://developer.apple.com/documentation/quartzcore/careplicatorlayer">CAReplicatorLayer</a> and set its <code class="language-plaintext highlighter-rouge">instanceCount</code> property to the number of dots that can fit in.</li> </ol> <h3 id="using-careplicatorlayer-for-dotted-lines">Using CAReplicatorLayer for dotted lines:</h3> <p>I have talked about <a href="https://vinayjain.me/posts/conversation-with-calayer#careplicatorlayer">CAReplicatorLayer</a> earlier as well. I remembered that I had implemented a typing indicator with the help of layer replication so I gave it a try again to build a dotted line.</p> <div class="align-center"> <img src="/images/ca-layer/typing.gif"/> </div> <p>The benefit I see for using CAReplicatorLayer is that it works on the basis of instance count which you cannot give for the other two ways. And the centering logic becomes easy as you can just set the frame of this layer to center of the view. Have a look at the code below to see how it is done, I am adding comments inline to avoid any further explanation.</p> <figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="n">layer</span><span class="o">.</span><span class="n">rasterizationScale</span> <span class="o">=</span> <span class="kt">UIScreen</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">scale</span>
<span class="n">layer</span><span class="o">.</span><span class="n">shouldRasterize</span> <span class="o">=</span> <span class="kc">true</span>

<span class="k">let</span> <span class="nv">spacing</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">8</span>
<span class="k">let</span> <span class="nv">dotRadius</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1">// We want every replicated instance to be translated</span>
<span class="c1">// by this factor</span>
<span class="k">let</span> <span class="nv">translateFactor</span> <span class="o">=</span> <span class="p">((</span><span class="n">dotRadius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">count</span> <span class="o">=</span> <span class="kt">Int</span><span class="p">((</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="n">translateFactor</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">circle</span> <span class="o">=</span> <span class="kt">CAShapeLayer</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="kt">UIBezierPath</span><span class="p">(</span><span class="nv">ovalIn</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dotRadius</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dotRadius</span><span class="p">))</span>
<span class="n">circle</span><span class="o">.</span><span class="n">fillColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="n">black</span><span class="o">.</span><span class="n">cgColor</span>
<span class="n">circle</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">cgPath</span>

<span class="k">let</span> <span class="nv">replicator</span> <span class="o">=</span> <span class="kt">CAReplicatorLayer</span><span class="p">()</span>
<span class="n">replicator</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
<span class="n">replicator</span><span class="o">.</span><span class="n">instanceCount</span> <span class="o">=</span> <span class="n">count</span>

<span class="c1">// translate every next instance by translateFactor</span>
<span class="k">var</span> <span class="nv">transform</span> <span class="o">=</span> <span class="kt">CATransform3DIdentity</span>
<span class="n">transform</span> <span class="o">=</span> <span class="kt">CATransform3DTranslate</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">translateFactor</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
<span class="n">replicator</span><span class="o">.</span><span class="n">instanceTransform</span> <span class="o">=</span> <span class="n">transform</span>
<span class="n">layer</span><span class="o">.</span><span class="nf">addSublayer</span><span class="p">(</span><span class="n">replicator</span><span class="p">)</span>
<span class="n">replicator</span><span class="o">.</span><span class="n">masksToBounds</span> <span class="o">=</span> <span class="kc">true</span>

<span class="k">let</span> <span class="nv">dotsWidth</span> <span class="o">=</span> <span class="kt">CGFloat</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="o">*</span> <span class="n">translateFactor</span> <span class="o">-</span> <span class="n">spacing</span>

<span class="c1">// Find the new origin for replicator layer</span>
<span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">dotsWidth</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

<span class="c1">// Use the new x value in the frame</span>
<span class="c1">// so as to center the replicator layer</span>
<span class="c1">// in view bounds</span>
<span class="n">replicator</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">dotsWidth</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">rect</span><span class="o">.</span><span class="n">height</span><span class="p">)</span></code></pre></figure> <p>The main reason for using <code class="language-plaintext highlighter-rouge">CAReplicatorLayer</code> here is that it gives me more control to each dot and every instance is animatable, so if there are any changes to be done on this dotted line, those can be done easily. Regarding performance, I haven’t done any kind of benchmarking on which approach is efficient as I am drawing this layer only at one place. But if you really want to know, I think the <code class="language-plaintext highlighter-rouge">CAShapeLayer</code> base implementation will out perform this approach beacuse using that you only draw one layer. If you have any suggestions and feedbacks to improve this please do let me know in the comments.</p> </div><div id="disqus_thread"></div> <script>var disqus_config=function(){this.page.url="https://vinayjain.me/posts/drawing-dotted-line-in-ios",this.page.identifier="https://vinayjain.me/posts/drawing-dotted-line-in-ios"};!function(){var t=document,e=t.createElement("script");e.src="https://koderme.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}();</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/posts/drawing-dotted-line-in-ios" hidden></a> </article> </div> </main> <footer> <p>© Vinay Jain 2022 </p> </footer> <script src="/assets/js/main.js?v=2"></script> </body> </html>